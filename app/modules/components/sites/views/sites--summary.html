<div data-ng-include="'/templates/header--view.html'"></div>

<main class="container">
  <div class="row feature">

    <div class="throbber throbber-small"
         data-ng-if="page.status.loading"></div>

    <article class="feature-detail"
             data-ng-if="!page.status.loading">
      <div class="column-11 feature-detail-content">
        <h4>
          <span data-ng-if="page.project.id && page.project.properties.program_type" class="label" data-ng-class="{'label-info': (page.project.properties.program_type !== 'Pre-Project Plan'), 'label-success': (page.project.properties.program_type === 'Pre-Project Plan')}">{{ page.project.properties.program_type }}</span>
          <span data-ng-if="page.project.id && page.project.properties.account.properties.name" class="label">{{ page.project.properties.account.properties.name }}</span>
          <span data-ng-if="page.project.id && !page.project.properties.account.properties.name && page.project.properties.program_type !== 'Pre-Project Plan'" class="label label-danger">No Funder</span>

          <span data-ng-if="page.project.id && page.project.properties.last_modified_by.properties.first_name && page.project.properties.last_modified_by.properties.last_name" class="label">Last Modified by: {{ page.project.properties.last_modified_by.properties.first_name }} {{ page.project.properties.last_modified_by.properties.last_name }}</span>
          <span data-ng-if="page.project.id && page.project.properties.modified_on" class="label">Modified on: {{ page.project.properties.modified_on | date }}</span>
        </h4>

        <img data-ng-if="page.site.geometry" class="pull-left" style="margin-right: 16px;"
             data-ng-src="https://api.tiles.mapbox.com/v4/{{ page.mapbox.map_id }}/pin-s+b1c11d({{ page.site.geometry.geometries[0].coordinates[0] }},{{ page.site.geometry.geometries[0].coordinates[1] }},17)/{{ page.site.geometry.geometries[0].coordinates[0] }},{{ page.site.geometry.geometries[0].coordinates[1] }},17/80x80@2x.png?access_token={{ page.mapbox.access_token }}"
             alt="{{ page.site.site_description }} location preview" width="80" height="80" />

        <h4 class="project-site-city">
          {{ page.project.properties.name }}
        </h4>
        <h1>
          {{ page.site.properties.name }}
        </h1>
        <h4 class="project-site-city">
          <span data-ng-if="page.site.properties.city">{{ page.site.properties.city }}</span><span data-ng-if="page.site.properties.city && page.site.properties.county.properties.county_name">,</span>
          <span data-ng-if="page.site.properties.county.properties.county_name">{{ page.site.properties.county.properties.county_name }} County</span><span data-ng-if="page.site.properties.state && page.site.properties.county.properties.county_name">,</span> {{ page.site.properties.state }}
        </h4>
        <h4 class="project-site-city">
          <span data-ng-if="page.site.id && page.site.properties.last_modified_by.properties.first_name && page.site.properties.last_modified_by.properties.last_name">Last Modified by: {{ page.site.properties.last_modified_by.properties.first_name }} {{ page.site.properties.last_modified_by.properties.last_name }}</span>
          <span data-ng-if="page.site.id && page.site.properties.modified_on">Modified on: {{ page.site.properties.modified_on | date }}</span>
        </h4>
        <h4 class="project-site-city">
          <span data-ng-if="page.site.properties.segment.properties.hgmr_code">{{ page.site.properties.segment.properties.hgmr_code }}</span>,
          <span data-ng-if="page.site.properties.segment.properties.hgmr_name">{{ page.site.properties.segment.properties.hgmr_name }}</span>,
          <span data-ng-if="page.site.properties.segment.properties.river_name">{{ page.site.properties.segment.properties.river_name }}</span>
        </h4>

        <br />

        <p data-ng-if="page.practices"
           class="pull-right">
          <strong>
            {{ page.practices.length | number }} <span data-ng-if="page.practices.length !== 1">practices</span><span data-ng-if="page.practices.length === 1">practice</span>
          </strong>
        </p>
        <section class="statistics--container">
        <article class="row statistics statistics--navigation"
                 data-ng-if="page.practices">
          <div class="column-2 statistics--statistic statistics--statistic--all"
               data-ng-class="{'statistics--statistic--active': (page.rollups.active === 'all')}"
               data-ng-click="page.rollups.active = 'all'">
               <p class="statistic--value">
                   <span class="statistic--title">All</span>
               </p>
          </div>
          <div class="column-5 statistics--statistic"
               data-ng-class="{'statistics--statistic--active': (page.rollups.active === 'nitrogen')}"
               data-ng-click="page.rollups.active = 'nitrogen'">
            <p class="statistic--value">
                {{ page.rollups.nitrogen.installed | number:2 }} <span class="statistic--valueLabel">of</span> {{ page.rollups.nitrogen.total | number:2 }} <span class="statistic--valueLabel">lbs/yr</span><br />
                <span class="statistic--title">Nitrogen</span>
            </p>
            <div class="statistic--chart">
              <div class="statistic--chart--value"
                   data-ng-style="{'width': ((page.rollups.nitrogen.installed/page.rollups.nitrogen.total)*100) + '%' }">
              </div>
            </div>
          </div>
          <div class="column-4 statistics--statistic"
               data-ng-class="{'statistics--statistic--active': (page.rollups.active === 'phosphorus')}"
               data-ng-click="page.rollups.active = 'phosphorus'">
            <p class="statistic--value">
                {{ page.rollups.phosphorus.installed | number:2 }} <span class="statistic--valueLabel">of</span> {{ page.rollups.phosphorus.total | number:2 }} <span class="statistic--valueLabel">lbs/yr</span><br />
                <span class="statistic--title">Phosphorus</span>
            </p>
            <div class="statistic--chart">
              <div class="statistic--chart--value"
                   data-ng-style="{'width': ((page.rollups.phosphorus.installed/page.rollups.phosphorus.total)*100) + '%' }">
              </div>
            </div>
          </div>
          <div class="column-5 statistics--statistic"
               data-ng-class="{'statistics--statistic--active': (page.rollups.active === 'sediment')}"
               data-ng-click="page.rollups.active = 'sediment'">
            <p class="statistic--value">
                {{ page.rollups.sediment.installed | number:2 }} <span class="statistic--valueLabel">of</span> {{ page.rollups.sediment.total | number:2 }} <span class="statistic--valueLabel">tons/yr</span><br />
                <span class="statistic--title">Sediment</span>
            </p>
            <div class="statistic--chart">
              <div class="statistic--chart--value"
                   data-ng-style="{'width': ((page.rollups.sediment.installed/page.rollups.sediment.total)*100) + '%' }">
              </div>
            </div>
          </div>
        </article>
      </section>

        <!-- PRACTICE N/P/S BREAKDOWN -->
        <!-- All -->
        <section class="row metrics"
                data-ng-show="page.rollups.active === 'all'">
          <article class="row"
                   data-ng-repeat="practice in page.rollups.all.practices | orderBy:'name' track by $index">
            <div class="column-3"></div>
             <div class="column-10 metrics--metric">
               <p class="metric--title">
                 {{ practice.name }}

                 <span class="metric--help--text pull-right"
                       data-ng-if="!practice.inactive">
                   {{ practice.percentage.whole | number:0 }}% installed
                 </span>
                 <span class="metric--help--text pull-right"
                       data-ng-if="practice.inactive">
                   unable to calculate
                 </span>
               </p>

               <div class="metric--chart">
                 <div class="metric--chart--value"
                      data-ng-if="!practice.inactive"
                      data-ng-style="{'width': practice.percentage.whole + '%' }"></div>
               </div>
             </div>
             <div class="column-3"></div>
          </article>
        </section>
        <section class="row metrics"
                data-ng-if="!page.rollups.nitrogen.practices"
                data-ng-show="page.rollups.active === 'nitrogen'">
          <article class="row ">
             <div class="column-3"></div>
             <div class="column-10 metrics--metric">
               <p>
                 <em>
                   No readings for nitrogen.
                 </em>
               </p>
             </div>
             <div class="column-3"></div>
           </article>
         </section>

         <!-- NITROGEN -->
         <section class="row metrics"
                 data-ng-show="page.rollups.active === 'nitrogen'">
           <article class="row"
                    data-ng-repeat="practice in page.rollups.nitrogen.practices | orderBy:'name' track by $index">
              <div class="column-3"></div>
              <div class="column-10 metrics--metric">
                <p class="metric--title">
                  <a href="/projects/{{ page.site.properties.project_id }}/sites/{{ page.site.id }}/practices/{{ practice.id }}/{{ page.site.practices.cleanName(practice.name) }}">
                    {{ practice.name }} #{{ $index+1 }}
                  </a>

                  <span class="metric--help--text pull-right"
                        data-ng-if="!practice.inactive">
                    {{ practice.installed | number:2 }} of {{ practice.total | number:2 }} lbs/yr
                  </span>
                  <span class="metric--help--text pull-right"
                        data-ng-if="practice.inactive">
                    not applicable
                  </span>

                </p>
                <div class="metric--chart">
                  <div class="metric--chart--value"
                       data-ng-if="!practice.inactive"
                       data-ng-style="{'width': practice.percentage.whole + '%' }"></div>
                </div>
              </div>
              <div class="column-3"></div>
           </article>
         </section>
         <section class="row metrics"
                 data-ng-if="!page.rollups.nitrogen.practices"
                 data-ng-show="page.rollups.active === 'nitrogen'">
           <article class="row ">
              <div class="column-3"></div>
              <div class="column-10 metrics--metric">
                <p>
                  <em>
                    No readings for nitrogen.
                  </em>
                </p>
              </div>
              <div class="column-3"></div>
            </article>
          </section>

          <!-- PHOSPHORUS -->
          <section class="row metrics"
                  data-ng-if="page.rollups.phosphorus.practices"
                  data-ng-show="page.rollups.active === 'phosphorus'">
            <article class="row"
                     data-ng-repeat="practice in page.rollups.phosphorus.practices | orderBy:'name' track by $index">
               <div class="column-3"></div>
               <div class="column-10 metrics--metric">
                 <p class="metric--title">
                   <a href="/projects/{{ page.site.properties.project_id }}/sites/{{ page.site.id }}/practices/{{ practice.id }}/{{ page.site.practices.cleanName(practice.name) }}">
                     {{ practice.name }} #{{ $index+1 }}
                   </a>

                   <span class="metric--help--text pull-right"
                         data-ng-if="!practice.inactive">
                     {{ practice.installed | number:2 }} of {{ practice.total | number:2 }} lbs/yr
                   </span>
                   <span class="metric--help--text pull-right"
                         data-ng-if="practice.inactive">
                     not applicable
                   </span>

                 </p>
                 <div class="metric--chart">
                   <div class="metric--chart--value"
                        data-ng-if="!practice.inactive"
                        data-ng-style="{'width': practice.percentage.whole + '%' }"></div>
                 </div>
               </div>
               <div class="column-3"></div>
            </article>
          </section>
          <section class="row metrics"
                  data-ng-if="!page.rollups.phosphorus.practices"
                  data-ng-show="page.rollups.active === 'phosphorus'">
            <article class="row ">
               <div class="column-3"></div>
               <div class="column-10 metrics--metric">
                 <p>
                   <em>
                     No readings for phosphorus.
                   </em>
                 </p>
               </div>
               <div class="column-3"></div>
             </article>
           </section>

          <!-- SEDIMENT -->
          <section class="row metrics"
                  data-ng-if="page.rollups.sediment.practices"
                  data-ng-show="page.rollups.active === 'sediment'">
            <article class="row"
                     data-ng-repeat="practice in page.rollups.sediment.practices | orderBy:'name' track by $index">
               <div class="column-3"></div>
               <div class="column-10 metrics--metric">
                 <p class="metric--title">
                   <a href="{{ practice.url }}">
                     {{ practice.name }} #{{ $index+1 }}
                   </a>

                   <span class="metric--help--text pull-right"
                         data-ng-if="!practice.inactive">
                     {{ practice.installed | number:2 }} of {{ practice.total | number:2 }} lbs/yr
                   </span>
                   <span class="metric--help--text pull-right"
                         data-ng-if="practice.inactive">
                     not applicable
                   </span>

                 </p>
                 <div class="metric--chart">
                   <div class="metric--chart--value"
                        data-ng-if="!practice.inactive"
                        data-ng-style="{'width': practice.percentage.whole + '%' }"></div>
                 </div>
               </div>
               <div class="column-3"></div>
            </article>

            <article class="row" data-ng-if="page.rollups.sediment.practices.length === 0">
               <div class="column-3"></div>
               <div class="column-10 metrics--metric">
                 <p class="align-center metric--help--text">
                   <br />
                   <em>
                     No readings for sediment.
                   </em>
                 </p>
               </div>
               <div class="column-3"></div>
             </article>
          </section>


          <section class="row">
            <div class="column-16">
              <br />
              <h2><strong>CHESAPEAKE</strong> BAY METRICS</h2>
            </div>
          </section>

          <!-- SITE CHESAPEAKE BAY METRICS BREAKDOWN -->
          <section class="row metrics statistics">
            {{ page.rollups.metrics }}
            <!-- <article class="row ">
             <div class="column-8 metrics--metric"
                  data-ng-if="metric.total"
                  data-ng-repeat="metric in page.rollups.metrics track by $index">
               <p class="metric--title">
                 {{ metric.label }}
               </p>
               <div class="metric--chart">
                 <div class="metric--chart--value"
                      data-ng-style="{'width': '{{ metric.percentage.whole }}%' }"></div>
               </div>
               <p class="metric--help--text">
                 {{ metric.installed | number:2 }} of {{ metric.total | number:2 }} {{ metric.units }}
               </p>
             </div>
            </article> -->
          </section>

        <section class="list action-list">

          <article class="row list-item"
                   data-ng-if="page.practices && page.practices.length"
                   data-ng-repeat="practice in page.rollups.nitrogen.practices | orderBy:'name' track by $index">
             <div class="column-16 list-item-content">
              <h1>
                <a href="/projects/{{ page.site.properties.project_id }}/sites/{{ page.site.id }}/practices/{{ practice.id }}/{{ page.site.practices.cleanName(practice.name) }}">
                  {{ practice.name }}
                </a>
                <span class="creation-date">
                  Created on {{ practice.created_on | date }}
                </span>
              </h1>
              <div class="thumbnails" data-ng-if="practice.attachment_4513d48492f2485ebcdc3293a3c3695e.length">
                <h6>Installation Photos</h6>
                <div data-ng-repeat="image in practice.attachment_4513d48492f2485ebcdc3293a3c3695e" class="thumbnail">
                  <img ng-src="//{{ image.filepath }}" alt="" title="" />
                </div>
              </div>
              <div class="thumbnails" data-ng-if="practice.attachment_deeff980383d47b7869b626080388ec5.length">
                <h6>Mature Photos</h6>
                <div data-ng-repeat="image in practice.attachment_deeff980383d47b7869b626080388ec5" class="thumbnail">
                  <img ng-src="//{{ image.filepath }}" alt="" title="" />
                </div>
              </div>
            </div>
          </article>
        </section>

      </div>
      <nav class="column-5 contextual-navigation-wrapper">
        <h6><strong>Tools</strong></h6>
        <ul class="contextual-navigation">
          <!-- Site Manangement Navigation -->
          <li class="active">
            <a href="/projects/{{ page.site.properties.project_id }}/sites/{{ page.site.id }}">
              Site Overview
            </a>
          </li>
          <li data-ng-if="page.permissions.can_edit">
            <a href="/projects/{{ page.site.properties.project_id }}/sites/{{ page.site.id }}/edit">
              Edit
            </a>
          </li>
        </ul>
      </nav>
    </article>
  </div>
</main>

<div data-ng-include="'/templates/footer--view.html'"></div>
