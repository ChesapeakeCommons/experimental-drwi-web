<div data-ng-include="'/templates/header--view.html'"></div>

<main class="site--content--flow fluid-content clearfix distinguish">

    <div id="sidebar" data-ng-include="'/templates/side-bar.html'"></div>

    <div class="content--container" style="border-right: 1px solid #e0e0e0;">

        <div class="progress--modal reveal fade-in t0" data-ng-if="page.status.loading">
            <div class="progress--container">
                <p style="font-weight: bold;" class="color-pulse">Loading report data&hellip;</p>
            </div>
        </div>

        <section class="privacy-message reveal fade-in t0" data-ng-if="!page.status.loading && page.makePrivate">

            <p>
                <i class="material-icons">
                    lock
                </i>
            </p>

            <p>This practice is private.</p>

        </section>

        <h1 class="inset reveal fade-in t0" data-ng-if="!page.status.loading && !page.makePrivate">Edit report</h1>

        <div class="main--ui reveal fade-in t0" data-ng-if="!page.status.loading && !page.makePrivate">

            <article class="feature-detail">

                <div class="feature-detail-content">

                    <form data-ng-submit="page.saveMetrics()" class="form" role="form">

                        <h2>
                            Report date and measurement period
                        </h2>

                        <div class="form-element">
                            <span class="meta-label"><b>Month</b></span>
                            <input id="report_date_month" name="report_date_month" type="text" value="page.date.month" data-ng-model="page.date.month" uib-typeahead="month.name for month in page.months | filter:$viewValue | limitTo:5" typeahead-min-length="0" typeahead-template-url="templates/search--tpl.html" required="required">
                        </div>

                        <div class="form-element">
                            <span class="meta-label"><b>Date</b></span>
                            <input type="number" min="1" max="31" step="1" id="report_date_date" name="report_date_date" data-ng-model="page.date.date" />
                        </div>

                        <div class="form-element">
                            <span class="meta-label"><b>Year</b></span>
                            <input number type="number" min="1900" step="1" id="report_date_year" name="report_date_year" data-ng-model="page.date.year" />
                        </div>

                        <!-- Measurement Period -->

                        <div class="form-element">
                            <span class="meta-label"><b>Measurement period</b></span>
                            <input id="measurement_period" name="measurement_period" type="text" data-ng-model="page.report.properties.measurement_period" uib-typeahead="period as period.name for period in page.measurementPeriods | filter:$viewValue | limitTo:5" typeahead-min-length="0" typeahead-template-url="templates/search--tpl.html" required="required">
                        </div>

                        <h2>Load reductions</h2>

                        <div data-ng-if="(page.report.properties.measurement_period === 'Planning' || page.report.properties.measurement_period === 'Installation') || (page.report.properties.measurement_period.name === 'Planning' || page.report.properties.measurement_period.name === 'Installation')">

                            <div class="form-element">

                                <div class="form-element">
                                    <span class="meta-label"><b>Practice area</b></span>
                                    <input class="form-control" data-ng-model="page.report.properties.practice_extent" id="practice_extent" name="practice_extent" step="0.0001" type="number" placeholder="0" />
                                </div>

                                <div class="form-element">
                                    <span class="meta-label"><b>Area units</b></span>
                                    <input type="text" class="form-control" id="email" name="email" disabled="disabled" value="acres" required="required" readonly />
                                    <p style="color: #9e9e9e; font-size: 0.9em; font-style: normal; margin-top: 0.5em;">
                                        Practice area is standardized to acres.
                                    </p>
                                </div>

                                <div class="form-element">
                                    <!-- Nitrogen -->
                                    <span class="meta-label"><b>Nitrogen (pounds per year)</b></span>
                                    <input class="form-control" data-ng-model="page.report.properties.custom_model_nitrogen_total" id="nitrogen_reduction" name="nitrogen_reduction" step="0.01" min="0" type="number" />

                                </div>

                                <div class="form-element">
                                    <!-- Phosphorus -->
                                    <span class="meta-label"><b>Phosphorus (pounds per year)</b></span>
                                    <input class="form-control" data-ng-model="page.report.properties.custom_model_phosphorus_total" id="phosphorus_reduction" name="phosphorus_reduction" step="0.01" min="0" type="number" />
                                </div>

                                <div class="form-element">
                                    <!-- Sediment -->
                                    <span class="meta-label"><b>Sediment (tons per year)</b></span>
                                    <input class="form-control" data-ng-model="page.report.properties.custom_model_sediment_total" id="sediment_reduction" name="sediment_reduction" step="0.01" min="0" type="number" />
                                </div>

                            </div>

                        </div>

                        <h2>Metric Data</h2>

                        <div data-ng-if="(page.report.properties.measurement_period === 'Planning' || page.report.properties.measurement_period === 'Installation') || (page.report.properties.measurement_period.name === 'Planning' || page.report.properties.measurement_period.name === 'Installation')">
                            <div>
                                <button type="button" data-ng-click="page.addMetric()" class="button button-link button-outline">
                                    + Add metric data
                                </button>
                            </div>
                        </div>

                        <br /><br />

                        <div data-ng-repeat="reportMetric in page.reportMetrics | orderBy:'id':false track by reportMetric.id">

                            <p style="font-style: normal; font-size: 1em;">
                                <strong>Metric #{{ $index+1 }}</strong>
                            </p>

                            <div class="form-element" data-ng-if="!page.custom_metric_type[reportMetric.id]">

                                <!-- Practice -->
                                <span class="meta-label"><b>Metric type</b></span>

                                <input id="metric_type_id" name="metric_type_id" type="text" placeholder="Search metrics&hellip;" data-ng-model="reportMetric.metric_type" uib-typeahead="metric as metric.name for metric in page.metricTypes | filter:$viewValue | limitTo:5" typeahead-min-length="0" typeahead-template-url="templates/search--tpl.html" required="required">

                            </div>

                            <div class="form-element form-element-half">
                                <!-- Metric value -->
                                <span class="meta-label"><b>Metric value</b></span>
                                <input class="form-control" data-ng-model="reportMetric.metric_value" id="metric_value" name="metric_value" step="0.01" min="0" type="number" />
                            </div>

                            <div class="form-element form-element-half">
                                <!-- Units -->
                                <span class="meta-label"><b>Metric units</b></span>
                                <input id="reading_metric_unit_id" name="reading_metric_unit_id" type="text" placeholder="Search units&hellip;" data-ng-model="reportMetric.metric_unit" uib-typeahead="unit as unit.name for unit in page.unitTypes | filter:$viewValue | limitTo:5" typeahead-min-length="0" typeahead-template-url="templates/search--tpl.html" required="required">
                            </div>

                            <div class="form-element form-element-half">

                                <button type="button" class="button button-link button-outline pull-right" data-ng-click="page.confirmMetricDelete[reportMetric.id] =! page.confirmMetricDelete[reportMetric.id]" data-ng-if="!page.confirmMetricDelete[reportMetric.id] && page.report.properties.measurement_period === 'Planning'">
                                    Remove this metric
                                </button>

                                <span data-ng-if="page.confirmMetricDelete[reportMetric.id]" class="action pull-right">
                                    <a data-ng-click="page.deleteMetric(reportMetric.id)" class="remove">
                                        Yes, I'm sure, delete this metric</a> or <a class="cancel" data-ng-click="page.confirmMetricDelete[reportMetric.id] = false;">nevermind</a>
                                </span>

                            </div>

                        </div>

                        <div data-ng-if="page.report.properties.measurement_period === 'Monitoring'" data-ng-repeat="monitoring_ in page.report.properties.monitoring | orderBy:'id':false track by monitoring_.id">

                            <div>
                                <label for="" class="control-label">
                                    Custom Monitoring Check #{{ $index+1 }}
                                </label>
                            </div>

                            <div>

                                <div class="form-element">
                                    <!-- Practice Extent -->
                                    <label for="monitoring_value" class="control-label">
                                        Check Performed?
                                    </label>

                                    <input type="checkbox" class="form-control" data-ng-model="monitoring_.properties.was_verified" />

                                </div>

                                <!-- Column 1 of 2: Form Fields Column -->
                                <div class="form-element">

                                    <!-- Practice -->
                                    <label for="monitoring_type_id" class="control-label">
                                        Monitoring Check
                                    </label>

                                    <select data-ng-if="!page.custom_monitoring_type[monitoring_.id]" class="form-control" data-ng-model="monitoring_.properties.monitoring_type_id" id="monitoring_type_id" name="monitoring_type_id" data-ng-options="value.id as value.properties.name group by value.properties.group for value in page.monitoringTypes.features | orderBy:'properties.name'">
                                        <option value="">-- Select an adaptive management
                                            check --</option>
                                    </select>

                                    <div data-ng-if="page.custom_monitoring_type[monitoring_.id]">
                                        <input class="form-control" data-ng-model="monitoring_.properties.monitoring_type.properties.name" id="custom_monitoring_type_name" name="custom_monitoring_type_name" type="text" autofocus />

                                        <a href="javascript:void(0);" data-ng-click="page.actions.cancelAddMonitoringCheckType(monitoring_)">
                                            Cancel
                                        </a>

                                    </div>

                                    <div class="form-element form-element-half">
                                        <!-- Practice Extent -->
                                        <label for="monitoring_value" class="control-label">
                                            Monitoring Check Value
                                        </label>

                                        <input class="form-control" data-ng-model="monitoring_.properties.monitoring_value" id="monitoring_value" name="monitoring_value" step="0.0001" type="number" />

                                    </div>
                                    <div class="form-element form-element-half">
                                        <!-- Practice Extent -->
                                        <label for="monitoring_description" class="control-label">
                                            Description
                                        </label>

                                        <input class="form-control" data-ng-model="monitoring_.properties.monitoring_description" id="monitoring_description" name="monitoring_description" type="text" />

                                    </div>

                                    <div class="form-element form-element-half">

                                        <button type="button" class="button button-link button-outline pull-right" data-ng-click="page.confirmMonitoringCheckDelete[monitoring_.id] =! page.confirmMonitoringCheckDelete[monitoring_.id]" data-ng-if="!page.confirmMonitoringCheckDelete[monitoring_.id]">
                                            Remove this check
                                        </button>
                                        <span data-ng-if="page.confirmMonitoringCheckDelete[monitoring_.id]" class="action pull-right">
                                            <a data-ng-click="page.deleteMonitoringCheck(monitoring_.id)" class="remove">
                                                Yes, I'm sure, delete this check</a> or <a class="cancel" data-ng-click="page.confirmMonitoringCheckDelete[monitoring_.id] = false;">nevermind</a>
                                        </span>

                                    </div>

                                </div>

                            </div>

                        </div>

                        <div data-ng-if="page.report.properties.measurement_period === 'Monitoring'">
                            <div>
                                <label class="control-label">
                                    New Custom Monitoring Check
                                </label>
                            </div>
                            <div>
                                <button type="button" data-ng-click="page.addMonitoringCheck()" class="button button-link button-outline">
                                    + Add Another Monitoring Check
                                </button>

                            </div>
                        </div>

                        <br /><br />

                        <div class="form-element">
                            <span class="meta-label"><b>Notes</b></span>
                            <textarea class="form-control" msd-elastic data-ng-model="page.report.properties.notes">{{ page.report.properties.notes }}</textarea>
                        </div>

                        <div class="save--action--wrapper save--action--bottom">
                            <button type="submit" data-ng-disabled="page.status.processing">
                                <i class="material-icons" data-ng-if="page.status.processing">
                                    more_horiz
                                </i>
                                <i class="material-icons" data-ng-if="!page.status.processing">
                                    done
                                </i>
                            </button>
                        </div>

                    </form>

                </div>

            </article>

        </div>

    </div>

    <nav id="toolbar" class="toolbar" style="float: none; width: auto;">
        <ul>
            <li data-ng-class="{active: $root.toolbarState.dashboard}">
                <a href="/practices/{{ page.practice.id }}">
                    <i class="material-icons">
                        dashboard
                    </i>
                </a>
            </li>
            <li>
                <a href="/practices/{{ page.practice.id }}/edit">
                    <i class="material-icons">
                        edit
                    </i>
                </a>
            </li>
            <li>
                <div class="confirm--delete--popup" data-ng-if="page.deletionTarget && page.deletionTarget.id === page.report.id">
                    <p>Do you want to delete this report?</p>
                    <div class="actions">
                        <a class="snapshot--title" href="#" title="Delete forever" data-ng-click="page.deleteFeature()">
                            Yes
                        </a>
                        <a class="snapshot--title" href="#" title="Cancel" data-ng-click="page.cancelDelete()">
                            Cancel
                        </a>
                    </div>
                </div>
                <a href="#" data-ng-click="page.confirmDelete(page.report)">
                    <i class="material-icons">
                        delete
                    </i>
                </a>
            </li>
        </ul>
    </nav>

    <div class="transient--notification" data-ng-class="{show: page.alerts.length}">
        <div class="event--container">
            <div data-ng-repeat="alert in page.alerts" data-ng-class="{error: alert.type == 'error', success: alert.type == 'success'}">
                <span class="event--message">{{ alert.msg }}</span>
            </div>
        </div>
    </div>

</main>

<div data-ng-include="'/templates/footer--view.html'"></div>