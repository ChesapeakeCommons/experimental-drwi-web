<main role="main" class="atlas main snapshot" id="main">

    <div id="sidebar" data-ng-include="'/templates/atlas-menu-bar.html'"></div>

    <div class="menu-mask"
         style="position: absolute; top: 0; right: 0; bottom: 0; left: 0; background: rgba(0,0,0,0.1); z-index: 8;"
         data-ng-if="page.menuCollapsed"
         data-ng-click="page.toggleMenu()"></div>

    <div class="panel--container">

        <div class="sidebar" style="height: 0;">
            <div data-ng-include="'/modules/components/atlas/views/panel--view.html'"></div>
        </div>

        <div id="map">

            <div class="mapboxgl-layer-ctrl"
                 data-ng-click="page.showLayerOptions = !page.showLayerOptions" title="Switch layers">
                <i class="material-icons">
                    layers
                </i>
                <div class="layer-group" style="font-weight: normal; font-size: 14px; min-width: 240px;"
                     data-ng-show="page.showLayerOptions">
                    <div id="feature-scope" class="scope--control margin-0" style="padding: 0.5rem 0.75rem;
                    border-bottom: 1px solid #e0e0e0; flex-grow: 1; flex-shrink: 0;">
                        <div style="flex-grow: 1; flex-shrink: 0;" class="pad-r-1">
                            <strong>Show all my data</strong>
                        </div>
                        <label class="switch" style="flex-grow: 0; flex-shrink: 0; background: #FFFFFF;">
                            <input type="checkbox"
                                   data-ng-model="page.showAllFeatures"
                                   data-ng-checked="page.showAllFeatures"
                                   data-ng-change="page.toggleLayerConstraint()">
                            <div class="slider round"></div>
                        </label>
                    </div>
                    <form>
                        <label data-ng-repeat="style in page.mapStyles"
                               data-ng-class="{'active': page.activeStyle === $index}"
                               style="font-weight: normal;"
                               title="{{ style.name }}">
                            <input type="radio" id="base-style-{{ $index }}" name="active-style"
                                   data-ng-model="page.activeStyle" data-ng-value="{{ $index }}"
                                   data-ng-change="page.switchMapStyle(style, $index)"><span> {{ style.name }}</span>
                        </label>
                    </form>
                    <div style="font-size: .75rem; font-weight: bold; text-transform: uppercase; padding: .5rem
                    .75rem; border-top: 1px solid #e0e0e0;">
                        Layers
                    </div>
                    <form class="layers" data-ng-show="page.layers && page.layers.length">
                        <label for="layer-{{ $index }}" style="font-weight: normal;"
                               data-ng-repeat="layer in page.layers"
                               data-ng-if="layer.id !== 'fd.drainage.polygon' && layer.id !== 'wr.station.point'"
                               data-ng-class="{'active': layer.selected}" title="{{ layer.name }}">
                            <input type="checkbox" id="layer-{{ $index }}" name="layer-{{ $index }}"
                                   data-ng-model="layer.selected" data-ng-value="{{ $index }}"
                                   data-ng-change="page.toggleLayer(layer.id)">
                            <span> {{ layer.name }}</span>
                            <div class="symbol-group" data-ng-if="layer.symbol && layer.symbol.colors">
                                <div class="color" data-ng-repeat="color in layer.symbol.colors"
                                     style="background: {{ color }};"></div>
                            </div>
                        </label>
                        <label for="layer-{{ $index }}" style="font-weight: normal;"
                               data-ng-repeat="layer in page.layers"
                               data-ng-if="layer.id === 'wr.station.point' && $root.user.wr_token"
                               data-ng-class="{'active': layer.selected}" title="{{ layer.name }}">
                            <input type="checkbox" id="layer-{{ $index }}" name="layer-{{ $index }}"
                                   data-ng-model="layer.selected" data-ng-value="{{ $index }}"
                                   data-ng-change="page.toggleLayer(layer.id)">
                            <span> {{ layer.name }}</span>
                            <div class="symbol-group" data-ng-if="layer.symbol && layer.symbol.colors">
                                <div class="color" data-ng-repeat="color in layer.symbol.colors"
                                     style="background: {{ color }};"></div>
                            </div>
                        </label>
                        <label for="layer-{{ $index }}" style="font-weight: normal;"
                               data-ng-repeat="layer in page.layers"
                               data-ng-class="{'active': layer.selected}"
                               data-ng-if="layer.id === 'fd.drainage.polygon' && (page.primaryNode.properties.type === 'site' || page.primaryNode.properties.type === 'practice')"
                               title="{{ layer.name }}">
                            <input type="checkbox" id="layer-{{ $index }}" name="layer-{{ $index }}"
                                   data-ng-model="layer.selected" data-ng-value="{{ $index }}"
                                   data-ng-change="page.toggleLayer(layer.id)">
                            <span> {{ layer.name }}</span>
                            <div class="symbol-group" data-ng-if="layer.symbol && layer.symbol.colors">
                                <div class="color" data-ng-repeat="color in layer.symbol.colors"
                                     style="background: {{ color }};"></div>
                            </div>
                        </label>
                    </form>
                </div>
            </div>

            <div class="mapboxgl-filter-ctrl"
                 data-ng-click="page.showFilterModal = !page.showFilterModal"
                 title="Add filters">
                <i class="material-icons">
                    tune
                </i>
            </div>

        </div>

    </div>

    <section class="privacy-message reveal fade-in t0"
             data-ng-if="!page.status.loading && page.makePrivate">

        <p>
            <i class="material-icons">
                lock
            </i>
        </p>

        <p>This map is private.</p>

    </section>

    <div style="position: fixed; top: 0; right: 0; left: 0; bottom: 0; display: flex; flex-flow: column nowrap;
    justify-content: center; align-items: center;" data-ng-show="page.station"
         data-ng-click="page.station = undefined; page.toggleSidebar()">
        <iframe style="border: 1px solid #e0e0e0; border-radius: 0.5rem; overflow: hidden; min-height: 400px; width:
        100%; max-width: 640px;"
                height="480"
                width="640"
                src=""
                frameBorder="0"
                scrolling="no"></iframe>
    </div>

    <div class="multi-feature-modal-container"
         data-ng-show="page.queryFeatures && page.queryFeatures.length"
         data-ng-click="page.queryFeatures = undefined">
        <div class="multi-feature-modal pad-75p rad-50">
            <div class="title pad-l-50p margin-b-50p">
                <span class="title-text">
                    Multiple features found:
                </span>
                <div class="dismiss-container">
                    <div class="dismiss margin-0"
                         data-ng-click="page.queryFeatures = undefined">
                        <div class="halo"></div>
                        <span class="material-icons">
                        close
                    </span>
                    </div>
                </div>
            </div>
            <ul class="pad-0 margin-0">
                <li class="pad-50p"
                    data-ng-repeat="feature in page.queryFeatures"
                    data-ng-click="page.fetchPrimaryNode(
                        feature.properties.type,
                        feature.properties.id,
                        feature.programId)">
                    <span>
                        {{ feature.properties.name }}
                    </span>
                    <span class="pad-t-25p">
                        {{ feature.properties.type }}
                    </span>
                </li>
            </ul>
        </div>
    </div>

    <div class="atlas-filter-dialog-container"
         data-ng-if="page.showFilterModal">
        <form class="dialog" style="width: auto;"
              data-ng-if="!page.filterSet">
            <div class="title">
                <span class="title-text" style="font-size: 1.5rem; font-weight: 500;">
                    Filters
                </span>
                <div class="dismiss-container">
                    <div class="dismiss"
                         data-ng-click="page.showFilterModal = !page.showFilterModal">
                        <div class="halo"></div>
                        <span class="material-icons">
                            close
                        </span>
                    </div>
                </div>
            </div>
            <div class="inputs" style="overflow: auto;">
                <span class="flex prompt margin-b-1">
                    Add filter categories to map a subset of your projects. Note that filters override other map
                    settings and data, including projects currently in view.
                </span>
                <div class="pad-b-50p"
                     data-ng-repeat="(key, group) in page.filterOptions"
                     data-ng-click="page.filterSet = group; page.filterKey = key">
                    <div class="pad-b-1"
                          style="font-weight: 500; font-size: 1.125rem;">
                        {{ key | capitalAttribute }}
                    </div>
                    <div class="pad-b-1"
                         data-ng-if="!group.length">
                        <em>No {{ key | replaceChar: '_':' ' }} available.</em>
                    </div>
                    <div class="pad-b-1 select-filter-btn"
                         data-ng-if="group.length && !page.activeFilters[key].length"
                         data-ng-click="page.filterSet = group; page.filterKey = key">
                        Select {{ key | replaceChar: '_':' ' }} &rarr;
                    </div>
                    <div data-ng-if="group.length && page.activeFilters[key].length">
                        <div class="active-filter-node"
                             data-ng-repeat="feature in page.activeFilters[key]">
                            {{ feature.name }}
                        </div>
                    </div>
                    <div class="pad-t-50p pad-b-1 select-filter-btn"
                         style="font-size: .9rem;"
                         data-ng-if="group.length && page.activeFilters[key].length"
                         data-ng-click="page.filterSet = group; page.filterKey = key">
                        Edit selections &rarr;
                    </div>
                </div>
            </div>
            <div class="dialog-actions pad-1"
                 style="border-top: 1px solid #E0E0E0;">
                <div class="pad-r-1"
                     style="display: flex; flex-flow: row nowrap; align-items: center; justify-content: flex-start;
                     flex-grow: 1; flex-shrink: 1;">
                    <button type="button"
                            class="cancel"
                            data-ng-click="page.resetActiveFilters()">
                        Clear all
                    </button>
                </div>
                <button type="button"
                        class="cancel"
                        data-ng-click="page.showFilterModal = !page.showFilterModal">
                    Cancel
                </button>
                <button type="submit" class="confirm"
                        data-ng-click="page.captureFilters()">
                    Apply
                </button>
            </div>
        </form>
        <div class="dialog filter-options"
             data-ng-if="page.filterSet">
            <div class="title">
                <span class="title-text" style="padding-left: 1.5rem; font-size: 1.5rem; font-weight: 500;">
                    {{ page.filterKey | capitalAttribute }}
                </span>
                <div class="dismiss-container">
                    <div class="dismiss"
                         data-ng-click="page.setFilter(page.filterKey, page.filterSet)">
                        <div class="halo"></div>
                        <span class="material-icons">
                            close
                        </span>
                    </div>
                </div>
            </div>
            <input id="filter-option-search"
                   type="text"
                   data-ng-if="page.filterSet.length > 10"
                   data-ng-model="page.filterSearch"
                   placeholder="Search by name&hellip;">
            <div style="padding: 1rem 1.5rem; overflow: auto;">
                <ul class="margin-0 pad-0 margin-b-1">
                    <li class="pad-y-50p flex flex-dir-row flex-align-center"
                        data-ng-repeat="feature in page.filterSet | filter: page.filterSearch">
                        <div>
                            {{ feature.name }}
                        </div>
                        <div data-ng-if="feature.selected"
                             data-ng-click="feature.selected = !feature.selected">
                            <span class="material-icons">
                                check_box
                            </span>
                        </div>
                        <div data-ng-if="!feature.selected"
                             data-ng-click="feature.selected = !feature.selected">
                            <span class="material-icons">
                                check_box_outline_blank
                            </span>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
<!--        <div class="dialog"-->
<!--             data-ng-if="page.filterFocus === key"-->
<!--             data-ng-repeat="(key, group) in page.filterOptions">-->
<!--            <div class="title">-->
<!--                <span class="title-text" style="font-size: 1.5rem; font-weight: 500;">-->
<!--                    {{ key | capitalAttribute }}-->
<!--                </span>-->
<!--                <div class="dismiss-container">-->
<!--                    <div class="dismiss"-->
<!--                         data-ng-click="page.filterFocus === undefined">-->
<!--                        <div class="halo"></div>-->
<!--                        <span class="material-icons">-->
<!--                            close-->
<!--                        </span>-->
<!--                    </div>-->
<!--                </div>-->
<!--            </div>-->
<!--            <input id="filter-option-search"-->
<!--                   style="float:left; display:inline-block; clear:right;"-->
<!--                   type="text"-->
<!--                   class="search-bar list-filter"-->
<!--                   data-ng-model="page.filterSearch.q"-->
<!--                   placeholder="Search {{ key }}&hellip;">-->
<!--            <ul>-->
<!--                <li data-ng-repeat="feature in group | filter: page.filterSearch.q">-->
<!--                    {{ feature.name }}-->
<!--                </li>-->
<!--            </ul>-->
<!--        </div>-->
    </div>

</main>