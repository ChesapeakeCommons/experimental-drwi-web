<div data-ng-include="'/templates/header--view.html'"></div>

<main class="site--content--flow fluid-content clearfix distinguish">

    <div id="sidebar" data-ng-include="'/templates/side-bar.html'"></div>

    <div class="content--container" style="border-right: 1px solid #e0e0e0;">

        <div class="progress--modal reveal fade-in t0" data-ng-if="page.status.loading">
            <div class="progress--container">
                <p style="font-weight: bold;" class="color-pulse">Loading history data&hellip;</p>
            </div>
        </div>

        <section class="privacy-message reveal fade-in t0" data-ng-if="!page.status.loading && page.makePrivate">

            <p>
                <i class="material-icons">
                    lock
                </i>
            </p>

            <p>You do not have permission to view this page.</p>

        </section>

        <div class="main--ui breadcrumb-ui">

           <div class="group">

                <article class="breadcrumb">

                    <div style="display: inline-flex;" data-ng-repeat="crumb in page.feature.breadcrumb">
                        <span>{{ crumb.type_label }}:&nbsp;</span>
                        <a href="{{ crumb.type }}s/{{ crumb.id }}">{{ crumb.name }}</a>
                        <span>&nbsp;/&nbsp;</span>
                    </div>

                    <div style="display: inline-flex;">
                        History
                    </div>

                </article>

            </div>

        </div>

        <div class="breadcrumb-header-wrapper">
            <h1 class="inset breadcrumb-header" data-ng-if="!page.status.loading && !page.makePrivate">
                {{ page.feature.breadcrumb[page.feature.breadcrumb.length - 1].type_label }} history
            </h1>
        </div>

        <div class="main--ui" data-ng-if="!page.status.loading && !page.makePrivate">

                <div class="group reveal fade-in t2">

                    <section class="shadow">

                        <div class="collection-search reveal fade-in t0" style="justify-content: left; align-items: left; overflow: auto; flex-wrap: wrap;">
                            <input style="float:left; display:inline-block; clear:right;" type="text" class="search-bar list-filter" data-ng-if="!page.status.loading" data-ng-model="page.queryToken" placeholder="Search history">

                        </div>

                            <div data-ng-include="'/templates/pagination-view.html'"></div>

                            <div class="history-group list-unstyled" style="margin-top: 2em;">

                                <div class="card reveal fade-in pad shadow"
                                    style="width: 100%; animation-delay: {{ $index * 100 }}ms; min-height: 0;" data-ng-repeat="group in page.changeLog">

                                    <h2>
                                         {{ group.weekday }} &middot; {{ group.date | date:'longDate' }}
                                    </h2>

                                    <div data-ng-repeat="changeLogItem in group.changes | filter: page.queryToken">

                                        <div class="card--content">

                                            <div class="change-metadata">

                                                <div class="change-action">
                                                    <i class="material-icons" title="{{ changeLogItem.action_label }}">
                                                        {{ changeLogItem.op }}
                                                    </i>
                                                    <span title="{{ changeLogItem.timestamp.utc }} UTC">
                                                        {{ changeLogItem.action_label }}
                                                    </span>
                                                    <span>&nbsp;by&nbsp;</span>
                                                    <a href="/profile/{{changeLogItem.creator.id}}">
                                                        <strong>{{ changeLogItem.creator.first_name }} {{ changeLogItem.creator.last_name }}</strong>
                                                    </a>
                                                </div>

                                                <span>&nbsp;&middot;&nbsp;</span>

                                                <div class="timestamp">
                                                    <span>
                                                        {{ changeLogItem.timestamp.local | date:'longDate' }}
                                                    </span>
                                                    <span>&nbsp;at&nbsp;</span>
                                                    <span>
                                                        {{ changeLogItem.timestamp.local | date:'shortTime' }}
                                                    </span>
                                                </div>

                                            </div>

                                            <div data-ng-if="changeLogItem.diff">

                                                <table class="diff-table">

                                                    <thead>

                                                        <tr>

                                                            <th><strong>Property name</strong></th>

                                                            <th><strong>New value</strong></th>

                                                            <th><strong>Old value</strong></th>

                                                        </tr>

                                                    </thead>

                                                    <tbody>

                                                        <tr data-ng-repeat="(key, item) in changeLogItem.diff">

                                                            <td style="width: 20%;">
                                                                <strong>{{ key }}</strong>
                                                            </td>

                                                            <td class="new-val" style="width: 30%;">

                                                                <span data-ng-if="item.type !== 'number' && item.type !== 'geometry' && item.type !== 'object'">
                                                                    {{ item.new_value }} &nbsp;
                                                                </span>

                                                                <span data-ng-if="item.type === 'object'">
                                                                    {{ item.new_value.name }} &nbsp;
                                                                </span>

                                                                <span data-ng-if="item.type === 'number'">
                                                                    {{ item.new_value | number:2 }} &nbsp;
                                                                </span>

                                                                <div data-ng-if="item.type === 'geometry'">
                                                                    <img src="{{ item.new_staticURL }}"/>
                                                                </div>

                                                            </td>

                                                            <td class="prev-val" style="width: 30%;">

                                                                <span data-ng-if="item.type !== 'number' && item.type !== 'geometry' && item.type !== 'object'">
                                                                    {{ item.previous_value }} &nbsp;
                                                                </span>

                                                                <span data-ng-if="item.type === 'object'">
                                                                    {{ item.previous_value.name }} &nbsp;
                                                                </span>

                                                                <span data-ng-if="item.type === 'number'">
                                                                    {{ item.previous_value | number:2 }} &nbsp;
                                                                </span>

                                                                <div data-ng-if="item.type === 'geometry'">
                                                                    <img src="{{ item.previous_staticURL }}"/>
                                                                </div>

                                                            </td>

                                                        </tr>

                                                    </tbody>

                                                </table>

                                            </div>

                                            <div class="body" data-ng-if="!changeLogItem.diff">

                                                <div data-ng-if="changeLogItem.link && changeLogItem.linkTxt">

                                                    <a href="{{ changeLogItem.link }}">{{ changeLogItem.linkTxt }}</a>

                                                </div>

                                                <div data-ng-if="changeLogItem.deletedName">

                                                    <span>{{ changeLogItem.deletedName }}</span>

                                                </div>

                                            </div>

                                        </div>

                                    </div>

                                </div>

                            </div>



                        </section>

                    </div>

                </div>

            </div>

        </div>

    </div>

        <nav id="toolbar" class="toolbar" style="float: none; width: auto;" data-ng-if="$root.user.id">
        <ul>
            <li data-ng-class="{active: $root.toolbarState.dashboard}">
                <a href="/projects/{{ page.project.id }}" title="Summary">
                    <i class="material-icons">
                        dashboard
                    </i>
                </a>
            </li>
            <li data-ng-if="page.permissions.can_edit">
                <a href="/projects/{{ page.project.id }}/edit" title="Edit">
                    <i class="material-icons">
                        edit
                    </i>
                </a>
            </li>
            <li data-ng-if="page.permissions.can_edit" data-ng-class="{active: $root.toolbarState.grant}">
                <a href="/projects/{{ page.project.id }}/grant" title="Program">
                    <i class="material-icons">
                        account_balance
                    </i>
                </a>
            </li>
            <li data-ng-if="page.permissions.can_edit">
                <a href="/projects/{{ page.project.id }}/users" title="Collaborators">
                    <i class="material-icons">
                        group
                    </i>
                </a>
            </li>
            <li data-ng-if="page.permissions.can_edit" data-ng-class="{active: $root.toolbarState.partnerships}">
                <a href="/projects/{{ page.project.id }}/partnerships" title="Partnerships">
                    <i class="material-icons">
                        group_work
                    </i>
                </a>
            </li>
            <!-- <li data-ng-if="page.permissions.can_edit">
                <a href="/projects/{{ page.project.id }}/edit">
                    <i class="material-icons">
                        edit
                    </i>
                </a>
            </li> -->
            <li data-ng-if="page.permissions.can_edit" data-ng-class="{active: $root.toolbarState.editTargets}">
                <a href="/projects/{{ page.project.id }}/targets" title="Metrics">
                    <i class="material-icons">
                        multiline_chart
                    </i>
                </a>
            </li>
            <li data-ng-if="page.permissions.can_edit" data-ng-class="{active: $root.toolbarState.editTags}">
                <a href="/projects/{{ page.project.id }}/tags" title="Tags">
                    <i class="material-icons">
                        local_offer
                    </i>
                </a>
            </li>
            <li data-ng-if="page.permissions.can_edit">
                <a href="#" data-ng-click="page.print()" title="Print">
                    <i class="material-icons">
                        print
                    </i>
                </a>
            </li>
            <li data-ng-if="page.permissions.can_edit">
                <div class="confirm--delete--popup" data-ng-if="page.deletionTarget && page.deletionTarget.feature.id === page.project.id && page.deletionTarget.collection === 'project'">
                    <p>Do you want to delete this project?</p>
                    <div class="actions">
                        <a class="snapshot--title" href="#" title="Delete forever" data-ng-click="page.deleteFeature('project')" >
                            Yes
                        </a>
                        <a class="snapshot--title" href="#" title="Cancel" data-ng-click="page.cancelDelete()" >
                            Cancel
                        </a>
                    </div>
                </div>
                <a href="#" data-ng-click="page.confirmDelete(page.project, 'project')" title="Delete">
                    <i class="material-icons">
                        delete
                    </i>
                </a>
            </li>
        </ul>
    </nav>

    <div class="transient--notification" data-ng-class="{show: page.alerts.length}">
        <div class="event--container">
            <div data-ng-repeat="alert in page.alerts" data-ng-class="{error: alert.type == 'error', success: alert.type == 'success'}">
                <span class="event--message">{{ alert.msg }}</span>
            </div>
        </div>
    </div>

</main>

<div data-ng-include="'/templates/footer--view.html'"></div>