<div data-ng-include="'/templates/header--view.html'"></div>

<main class="container">
  <div class="row feature">
    <article class="feature-detail">
      <div class="column-11 feature-detail-content">
        <h1 class="large">Collaborators</h1>

        <hr />

        <!-- List of existing users -->
        <table class="table table-hover table-align-left">
          <thead>
            <tr>
              <th>&nbsp;</th>
              <th>Email</th>
              <th>Role</th>
              <th style="width:40%">Action</th>
            </tr>
          </thead>
          <tbody>
            <tr data-ng-repeat="user in page.project.properties.members track by $index">
              <td>
                <big>{{ user.properties.first_name }} {{ user.properties.last_name }}</big>
              </td>
              <td>
                <a href="mailto:{{ user.properties.email }}" target="_blank">
                  {{ user.properties.email }}
                </a>
              </td>
              <td>
                <span data-ng-if="user.id !== page.project.properties.creator_id">member</span>
                <span data-ng-if="user.id === page.project.properties.creator_id">creator</span>
              </td>
              <td class="action align-right">
                <div data-ng-if="user.id != $root.user.id">
                  <a data-ng-if="!page.project.properties.members[$index].remove_confirm" data-ng-click="page.project.properties.members[$index].remove_confirm = true;" class="remove">remove</a>
                  <span data-ng-if="page.project.properties.members[$index].remove_confirm" class="confirm">
                    <a data-ng-click="page.project.properties.members.splice($index, 1); page.users.remove(user);" class="remove">Remove from project?</a>
                    <span>or</span>
                    <a data-ng-click="page.project.properties.members[$index].remove_confirm = false;" class="cancel">go back</a>
                  </span>
                </div>
              </td>
            </tr>
          </tbody>
        </table>

        <div class="row">
          <div class="column-11">
            <form role="form" id="formInviteCollaborator" name="formInviteCollaborator"
                  data-ng-submit="page.collaborator.sendInvitations()">
              <div class="form-element">
                <div class="autocomplete">
                  <label class="control-label">
                    Add a Collaborator
                  </label>
                  <div class="typeAhead">
                    <input type="text" id="invitation" name="invitation"
                           data-ng-model="page.collaborator.query" class="form-control"
                           placeholder="Type in an email address..." collaborator-invite
                           collaborator-invite-query="page.collaborator.query"
                           collaborator-invite-response="page.collaborator.response"
                           autofocus="autofocus" />
                  </div>
                </div>
              </div>

              <div class="form-element">
                <ul data-ng-if="page.collaborator.invitations && page.collaborator.invitations.length">
                  <li data-ng-repeat="collaborator in page.collaborator.invitations track by $index">
                    <span data-ng-if="collaborator.properties.first_name">{{ collaborator.properties.first_name }}</span> <span data-ng-if="collaborator.properties.last_name">{{ collaborator.properties.last_name }}, </span><em>{{ collaborator.properties.email }}</em>
                  </li>
                </ul>
              </div>

              <div class="form-actions">
                <div class="form-actions-buttons">
                  <button type="submit" class="button button-submit">
                    Invite Collaborators
                  </button>
                </div>
              </div>
            </form>

          </div>
        </div>
      </div>

      <nav class="column-5 contextual-navigation-wrapper">
        <h6><strong>Tools</strong></h6>
        <ul class="contextual-navigation">
          <!-- Proect Manangement Navigation -->
          <li>
            <a href="/projects/{{ page.project.id }}">
                Project Overview
            </a>
          </li>
          <li data-ng-if="page.permissions.can_edit">
            <a href="/projects/{{ page.project.id }}/edit">Edit</a>
          </li>
          <li class="active" data-ng-if="page.permissions.can_edit">
            <a href="/projects/{{ page.project.id }}/users">Collaborators</a>
          </li>
        </ul>
      </nav>

    </article>
  </div>
</main>

<div data-ng-include="'/templates/footer--view.html'"></div>
