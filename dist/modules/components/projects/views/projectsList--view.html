<div data-ng-include="'/templates/header--view.html'"></div>

<main class="site--content--flow fluid-content clearfix distinguish">

    <div id="sidebar" data-ng-include="'/templates/side-bar.html'"></div>

    <div class="content--container">

        <div class="progress--modal reveal fade-in t0" data-ng-if="page.status.loading">
            <div class="progress--container">
                <p style="font-weight: bold;" class="color-pulse">Loading your projects&hellip;</p>
            </div>
        </div>

        <h1 class="inset">Projects</h1>

        <div class="main--ui">

            <div class="add--new--wrapper">
                <span>Create project</span>
                <a class="add--new--btn"
                   data-ng-click="page.showChildModal = !page.showChildModal">
                    <i class="material-icons">
                    add
                    </i>
                </a>
            </div>

            <p class="reveal fade-in t0" data-ng-if="!page.status.loading && page.summary.total">There <ng-pluralize count="page.summary.total" when="{'one': 'is','other': 'are'}"></ng-pluralize> <strong>{{ (page.summary.total | number) || 0 }}</strong>
                <ng-pluralize count="page.summary.total" when="{'one': 'project','other': 'projects'}"></ng-pluralize> in your collection.
            </p>

            <p class="reveal fade-in t0" data-ng-if="!page.status.loading && (page.summary.matches !== page.summary.total)">
                Showing
                <strong>{{ (page.summary.matches | number) || 0 }} </strong>
                filtered
                <ng-pluralize count="page.summary.matches" when="{'one': 'match','other': 'matches'}"></ng-pluralize>.
            </p>

            <div class="collection-filter-group"
                 data-ng-if="!page.status.loading && ($root.user.properties.is_admin || $root.user.properties.is_manager)"
                 style="border: 0px solid blue;
                        display:block;
                        min-width: 740px;
                        margin-bottom:0px;
                        "
            >
                <div style="
                        border: 0px solid purple;
                        float:left;
                        display: block;
                        width: 40%;
                        min-width: 600px;
                        margin-bottom: 0px;
                       "
                >

                        <div class="collection-filter drop-down program"
                             style="float:left; display:inline-block;">
                            <button type="button" data-ng-class="{'open-btn': (page.showModal.program || (page.filters.program > 0))}" data-ng-click="page.showModal.program = !page.showModal.program">
                                Programs&nbsp;
                                <i class="material-icons">
                                    arrow_drop_down
                                </i>
                            </button>
                            <form name="collection-filter-form" class="collection-filter-modal" style="width: auto;" data-ng-if="page.showModal.program">
                                <label data-ng-repeat="program in page.programs" data-ng-class="{'active': page.filters.program === program.id}" title="{{ program.name }}">
                                    <span class="input-mask" data-ng-if="page.filters.program === program.id">
                                        <i class="material-icons">
                                            radio_button_checked
                                        </i>
                                    </span>
                                    <span class="input-mask" data-ng-if="page.filters.program !== program.id">
                                        <i class="material-icons">
                                            radio_button_unchecked
                                        </i>
                                    </span>
                                    <input type="radio" id="program-option-{{ program.id }}" name="active-program" data-ng-model="page.filters.program" data-ng-value="{{ program.id }}" data-ng-change="page.inspectSearchParams(true)"><span> {{ program.name }}</span>
                                </label>
                            </form>
                        </div>

                        <div class="collection-filter drop-down organization"
                             style="float:left; display:inline-block;">
                            <button type="button" data-ng-class="{'open-btn': (page.showModal.organization || (page.filters.organization > 0))}" data-ng-click="page.showModal.organization = !page.showModal.organization">
                                Organizations&nbsp;
                                <i class="material-icons">
                                    arrow_drop_down
                                </i>
                            </button>
                            <form name="collection-filter-form" class="collection-filter-modal" style="width: auto;" data-ng-if="page.showModal.organization">
                                <label data-ng-repeat="organization in page.summary.organizations | orderBy:'name'" data-ng-class="{'active': page.filters.organization === organization.id}" title="{{ organization.name }}">
                                    <span class="input-mask" data-ng-if="page.filters.organization === organization.id">
                                        <i class="material-icons">
                                            radio_button_checked
                                        </i>
                                    </span>
                                    <span class="input-mask" data-ng-if="page.filters.organization !== organization.id">
                                        <i class="material-icons">
                                            radio_button_unchecked
                                        </i>
                                    </span>
                                    <input type="radio" id="organization-option-{{ organization.id }}" name="active-organization" data-ng-model="page.filters.organization" data-ng-value="{{ organization.id }}" data-ng-change="page.inspectSearchParams(true)"><span> {{ organization.name }}</span>
                                </label>
                            </form>
                        </div>

                        <div class="collection-filter drop-down category"
                             style="float:left; display:inline-block;">
                            <button type="button" data-ng-class="{'open-btn': (page.showModal.tag || (page.filters.tag > 0))}" data-ng-click="page.showModal.tag = !page.showModal.tag">
                                Tags&nbsp;
                                <i class="material-icons">
                                    arrow_drop_down
                                </i>
                            </button>
                            <form name="collection-filter-form" class="collection-filter-modal" style="width: auto;" data-ng-if="page.showModal.tag">
                                <label data-ng-repeat="tag in page.tags | orderBy:'name'" data-ng-class="{'active': page.filters.tag === tag.id}" title="{{ tag.name }}">
                                    <span class="input-mask" data-ng-if="page.filters.tag === tag.id">
                                        <i class="material-icons">
                                            radio_button_checked
                                        </i>
                                    </span>
                                    <span class="input-mask" data-ng-if="page.filters.tag !== tag.id">
                                        <i class="material-icons">
                                            radio_button_unchecked
                                        </i>
                                    </span>
                                    <input type="radio" id="tag-option-{{ tag.id }}" name="active-category" data-ng-model="page.filters.tag" data-ng-value="{{ tag.id }}" data-ng-change="page.inspectSearchParams(true)"><span> {{ tag.name }}</span>
                                </label>
                            </form>
                        </div>

                        <div class="collection-filter drop-down"
                             style="float:left; display:inline-block;">
                            <button type="button"
                                    data-ng-class="{'open-btn': page.showModal.status }"
                                    data-ng-click="page.showModal.status = !page.showModal.status">
                                Status&nbsp;
                                <i class="material-icons">
                                    arrow_drop_down
                                </i>
                            </button>
                            <div name="collection-filter-form" class="collection-filter-modal" style="width: auto;"
                                 data-ng-if="page.showModal.status">
                                <label
                                       data-ng-class="{'active': page.project_statuses == status}"
                                       title="All"
                                >
                                                <span class="input-mask"
                                                      data-ng-if="page.projects_status == status">
                                                    <i class="material-icons">
                                                    radio_button_checked
                                                    </i>
                                                </span>
                                    <span class="input-mask"
                                          data-ng-if="page.projects_status != status">
                                                    <i class="material-icons">
                                                    radio_button_unchecked
                                                    </i>
                                                </span>
                                    <input type="radio"
                                           id="status-option-all"
                                           name="active-program" data-ng-model="page.projects_status"
                                           data-ng-click="page.change_status('')"
                                           data-ng-value=""
                                    />
                                    <span>
                                 All

                                    </span>
                                </label>


                                <label data-ng-repeat="status in page.project_statuses"
                                       data-ng-class="{'active': page.project_statuses == status}"
                                       title="{{ status }}"
                                >
                                                <span class="input-mask"
                                                      data-ng-if="page.projects_status == status">
                                                    <i class="material-icons">
                                                    radio_button_checked
                                                    </i>
                                                </span>
                                    <span class="input-mask"
                                          data-ng-if="page.projects_status != status">
                                                    <i class="material-icons">
                                                    radio_button_unchecked
                                                    </i>
                                                </span>
                                    <input type="radio"
                                           id="status-option-{{ status }}"
                                           name="active-program" data-ng-model="page.projects_status"
                                           data-ng-click="page.change_status(status)"
                                           data-ng-value="status"
                                    />
                                    <span>
                                 {{ status | capitalAttribute}}

                                    </span>
                                </label>
                            </div>
                        </div>


                </div>

                <div class="scope--control"
                     style=" border:0px solid red;
                                        margin-top: 10px;
                                        float: right;
                                        width:150px;
                                    "
                >
                    <span></span>
                    <label class="switch">
                        <input class="inputdemo"
                               type="checkbox"
                               data-ng-model="page.archived"
                               data-ng-click="page.changeArchivedDisplay(!page.projects_archived)">
                        <div class="slider round"></div>
                    </label>
                    <span data-ng-class="{on: page.archived}" style="color:#616161;">Archived</span>
                </div>

                <div data-ng-include="'/templates/pagination-view.html'"></div>


            </div>


            <div class="features--container" data-ng-if="!page.status.loading">

                <ul class="snapshot--cards list-unstyled" style="margin-top: 2em;">

                    <li class="card reveal fade-in"
                        style="animation-delay: {{ $index * 150 }}ms;"
                        data-ng-repeat="project in page.projects | orderBy:'-modified_on' | filter: page.q">

                        <div class="card--content">

                            <!-- <div id="project-geography-preview-{{ $index }}" style="width: 100%; height: 200px;"></div> -->



                                <div class="status status_{{project.status}}"
                                     style= "    border-bottom-right-radius: 0px;
                                                 border-bottom-left-radius: 0px;
                                                 border-radius: 0px;
                                                 float:left;
                                                 border: 0px;
                                                 margin-right: 0px;

                                            "
                                >
                                   <span>{{project.status | capitalAttribute}}</span>

                                    <span ng-if="project.archived">- Archived</span>
                                </div>



                           <img data-ng-if="project.staticURL" data-ng-src="{{ project.staticURL }}" width="auto" height="auto" />

                            <img data-ng-if="!project.extent" data-ng-src="https://api.mapbox.com/styles/v1/mapbox/streets-v10/static/-98.5795,39.828175,6/400x130@2x?access_token=pk.eyJ1IjoiYm1jaW50eXJlIiwiYSI6IjdST3dWNVEifQ.ACCd6caINa_d4EdEZB_dJw" width="auto" height="auto" />

                            <div class="name" style="background: #fff; padding: 10px 16px 10px 16px;">
                                <span>{{ project.name }}</span>
                            </div>


                            <div class="body">
                                <div class="confirm--delete" data-ng-if="page.deletionTarget.id === project.id">
                                    <p>Do you want to delete this project?</p>
                                    <div class="actions" style="flex: 0;">
                                        <a class="snapshot--title" href="#" title="Delete forever" data-ng-click="page.deleteFeature(project, $index)">
                                            Yes
                                        </a>
                                        <a class="snapshot--title" href="#" title="Cancel" data-ng-click="page.cancelDelete()">
                                            Cancel
                                        </a>
                                    </div>
                                </div>
                                <p>{{ (project.description || 'No description') | truncate:80 }}</p>
                                <div class="actions">
                                    <a class="snapshot--title" href="/projects/{{ project.id }}" title="Project summary">
                                        <i class="material-icons">
                                        dashboard
                                        </i>
                                    </a>
                             <!--       <a class="snapshot--title" href="/projects/{{ project.id }}/edit" title="Edit project" data-ng-if="$root.user.properties.is_admin || project.organization_id == page.user.properties.organization.id">
                             -->
                                    <a class="snapshot--title" href="/projects/{{ project.id }}/edit" title="Edit project" data-ng-if="$root.user.properties.is_admin || project.organization_id == page.user.properties.organization.id || $root.user.properties.is_manager">
                                        <i class="material-icons">
                                        edit
                                        </i>
                                    </a>
                                    <a class="snapshot--title" href="#" title="Delete project" data-ng-click="page.confirmDelete(project)" data-ng-if="$root.user.properties.is_admin || project.organization_id == page.user.properties.organization.id || $root.user.properties.is_manager">
                             <!--       <a class="snapshot--title" href="#" title="Delete project" data-ng-click="page.confirmDelete(project)" data-ng-if="$root.user.properties.is_admin || project.organization_id == page.user.properties.organization.id">
                             -->
                                        <i class="material-icons">
                                            delete
                                        </i>
                                    </a>
                                </div>
                                <span><time datetime="{{ project.modified_on }}" title="{{ project.modified_on }}">Last updated {{ project.modified_on | date : 'mediumDate' }}</time></span>
                            </div>

                        </div>
                        
                    </li>

                    <li class="card" data-ng-if="!page.projects.length && page.permissions.can_edit">
                        <div class="card--content">
                            <div class="body">
                                <a title="Create practice"
                                   data-ng-click="page.showChildModal = !page.showChildModal">
                                    <i class="material-icons">
                                        add
                                    </i>
                                </a>
                            </div>
                        </div>
                    </li>

                </ul>

            </div>
            <div  style="border: 0px solid blue;
                        display:block;
                        min-width: 740px;
                        margin-bottom:0px;
                        "
                  >
                <div style="margin-top:-120px;" data-ng-include="'/templates/pagination-view.html'"></div>
            </div>
        </div>

    </div>

    <div class="transient--notification" data-ng-class="{show: page.alerts.length}">
        <div class="event--container">
            <div data-ng-repeat="alert in page.alerts" data-ng-class="{error: alert.type == 'error', success: alert.type == 'success'}">
                <span class="event--message">{{ alert.msg }}</span>
            </div>
        </div>
    </div>

    <div creation-dialog alerts="page.alerts" organization="$root.user.properties.organization_id"
         type="'project'" visible="page.showChildModal"></div>

</main>

<div data-ng-include="'/templates/footer--view.html'"></div>
